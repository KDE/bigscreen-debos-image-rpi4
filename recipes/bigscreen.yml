{{- $architecture := or .architecture "arm64" -}}

architecture: {{ $architecture }}

actions:
  - action: apt
    description: Mycroft Big screen specific packages
    packages:
      - plasma-nano
      - plasma-big-launcher
      - mycroft-skill-installer
      - kio-extras
      - plasma-workspace-wallpapers
      - python3-pip
      - plasma-settings
      - kde-config-mobile-networking
      - kwin-x11
      - python3-websocket
      - cec-utils
      - libcec-dev
      - raspi-userland
      - falkon
      - firefox 
      - pavucontrol

  - action: download
    url: https://mycroft.blue-systems.com/mycroft-skills-aarch64.tar.gz
    name: mycroft-skills
    filename: mycroft-skills-aarch64.tar.gz

  - action: overlay
    origin: mycroft-skills
    source: .
    destination: /var/tmp/mycroft-skills-aarch64.tar.gz

  - action: download
    url: https://mycroft.blue-systems.com/dotmycroft-setup-aarch64.tar.gz
    name: dotmycroft
    filename: dotmycroft-setup-aarch64.tar.gz

  - action: overlay
    origin: dotmycroft
    source: .
    destination: /var/tmp/dotmycroft-setup-aarch64.tar.gz

  - action: overlay
    description: Plasma for embedded systems specific overlay
    source: ../overlays/base-embedded

  - action: overlay
    description: Mycroft Big screen specific overlay
    source: ../overlays/bigscreen

  - action: run
    description: Setting up CEC
    chroot: true
    script: ../scripts/03-setup_cec.sh

  - action: run
    description: Setting up Skills
    chroot: true
    script: ../scripts/93-prepare-bigscreen-skills.sh
